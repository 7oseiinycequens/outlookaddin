<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>Email Webhook</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        button {
            padding: 8px 16px;
            background-color: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #005a9e;
        }
        #result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #dff6dd;
            color: #107c10;
        }
        .error {
            background-color: #fde7e9;
            color: #a80000;
        }
    </style>
    <script>
        Office.onReady(function() {
            document.getElementById("sendButton").onclick = sendToWebhook;
        });

        function sendToWebhook() {
            try {
                const item = Office.context.mailbox.item;
                const resultDiv = document.getElementById("result");
                
                // Create email data object
                const emailData = {
                    subject: item.subject || "(No subject)",
                    from: Office.context.mailbox.userProfile.emailAddress,
                    timestamp: new Date().toISOString()
                };
                
                resultDiv.textContent = "Sending to webhook...";
                resultDiv.className = "";
                
                // Get email body
                if (item.body) {
                    item.body.getAsync(Office.CoercionType.Text, function(resultBody) {
                        if (resultBody.status === Office.AsyncResultStatus.Succeeded) {
                            emailData.body = resultBody.value || "(No body)";
                            sendToWebhookServer(emailData, resultDiv);
                        } else {
                            emailData.body = "(Could not retrieve body)";
                            sendToWebhookServer(emailData, resultDiv);
                        }
                    });
                } else {
                    emailData.body = "(Body not available)";
                    sendToWebhookServer(emailData, resultDiv);
                }
            } catch (error) {
                console.error("Error in sendToWebhook:", error);
                document.getElementById("result").textContent = "Error: " + error.message;
                document.getElementById("result").className = "error";
            }
        }
        
        function sendToWebhookServer(emailData, resultDiv) {
            // Send to webhook
            fetch('https://2160cc8fd8f2.ngrok-free.app/webhook', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(emailData)
            })
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(function(data) {
                resultDiv.textContent = "Email sent to webhook successfully!";
                resultDiv.className = "success";
            })
            .catch(function(error) {
                resultDiv.textContent = "Error: " + error.message;
                resultDiv.className = "error";
                console.error('Error sending to webhook:', error);
            });
        }
    </script>
</head>
<body>
    <h2>Email Webhook</h2>
    <p>Send email to webhook</p>
    <button id="sendButton">Send to Webhook</button>
    <div id="result"></div>
</body>
</html>
